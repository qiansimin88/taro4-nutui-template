# 彩色日志工具使用指南 (consola)

本项目已集成 `consola` 彩色日志工具，提供更好的开发体验和日志可读性。

## 📦 已安装

```bash
pnpm add -D consola
```

## 🎨 可用的日志方法

### 基础用法

```typescript
import { log } from "@/utils/logger";

// ✅ 成功信息 - 绿色
log.success("用户登录成功");

// ℹ️ 普通信息 - 蓝色
log.info("获取到用户数据:", userData);

// ⚠️ 警告信息 - 黄色
log.warn("Token 即将过期");

// ❌ 错误信息 - 红色
log.error("网络请求失败:", error);

// 🐛 调试信息 - 灰色
log.debug("调试变量:", { foo: "bar" });

// 🚀 开始任务 - 青色
log.start("小程序启动中...");

// 📍 追踪信息 - 紫色
log.trace("函数调用栈");

// ❌ 失败信息 - 红色
log.fail("操作失败");

// ✅ 就绪信息 - 绿色
log.ready("服务已就绪");
```

### 带标签的日志

```typescript
import { log } from "@/utils/logger";

// 创建带标签的日志记录器
const authLogger = log.withTag("Auth");
const apiLogger = log.withTag("API");

authLogger.info("用户登录", { userId: "123" });
// 输出: [Auth] ℹ 用户登录 { userId: '123' }

apiLogger.error("请求失败", error);
// 输出: [API] ❌ 请求失败 ...
```

## 🎯 实际使用示例

### 在页面中使用

```typescript
import { log } from "@/utils/logger";

function MyPage() {
  const handleLogin = async () => {
    try {
      log.start("开始登录流程");

      const result = await loginApi();

      log.success("登录成功", result);
    } catch (error) {
      log.error("登录失败", error);
    }
  };

  return <View>...</View>;
}
```

### 在服务层使用

```typescript
import { log } from "@/utils/logger";

export const userService = {
  async getProfile() {
    const apiLog = log.withTag("UserService");

    try {
      apiLog.info("获取用户信息");
      const res = await http.get("/user/profile");
      apiLog.success("获取成功", res.data);
      return res.data;
    } catch (error) {
      apiLog.error("获取失败", error);
      throw error;
    }
  },
};
```

### 在 Store 中使用

```typescript
import { log } from "@/utils/logger";

export const useUserStore = create((set) => ({
  login: (token, userInfo) => {
    log.info("保存用户登录信息");
    set({ token, userInfo });
    log.success("登录状态已更新");
  },

  logout: () => {
    log.warn("用户退出登录");
    set({ token: "", userInfo: null });
  },
}));
```

## 🎨 日志颜色说明

| 方法      | 颜色    | 用途     | emoji |
| --------- | ------- | -------- | ----- |
| `success` | 🟢 绿色 | 操作成功 | ✅    |
| `info`    | 🔵 蓝色 | 普通信息 | ℹ️    |
| `warn`    | 🟡 黄色 | 警告信息 | ⚠️    |
| `error`   | 🔴 红色 | 错误信息 | ❌    |
| `debug`   | ⚪ 灰色 | 调试信息 | 🐛    |
| `start`   | 🔵 青色 | 开始任务 | 🚀    |
| `trace`   | 🟣 紫色 | 追踪信息 | 📍    |
| `fail`    | 🔴 红色 | 失败信息 | ❌    |
| `ready`   | 🟢 绿色 | 就绪信息 | ✅    |

## 📝 最佳实践

### 1. 使用语义化的日志级别

```typescript
// ❌ 不推荐
log.info("用户登录失败");

// ✅ 推荐
log.error("用户登录失败");
```

### 2. 为不同模块使用不同标签

```typescript
// 为每个模块创建专用的日志记录器
const authLog = log.withTag("Auth");
const payLog = log.withTag("Payment");
const orderLog = log.withTag("Order");

authLog.success("登录成功");
payLog.info("发起支付");
orderLog.warn("库存不足");
```

### 3. 在关键流程添加日志

```typescript
// App 启动
log.start("🚀 小程序启动");

// 关键操作
log.info("🔑 获取微信 code");
log.success("✨ 静默登录成功");

// 错误处理
log.error("❌ 请求失败");
```

### 4. 生产环境控制日志级别

日志工具已自动配置：

- 开发环境：显示所有级别日志 (包括 debug)
- 生产环境：只显示 info 及以上级别

## 🔧 配置说明

在 `src/utils/logger.ts` 中可以自定义配置：

```typescript
const logger = createConsola({
  level: process.env.NODE_ENV === "development" ? 4 : 3,
  fancy: true, // 彩色输出
  formatOptions: {
    colors: true, // 启用颜色
    date: true, // 显示时间戳
  },
});
```

## 📚 更多文档

- [consola GitHub](https://github.com/unjs/consola)
- [consola 文档](https://unjs.io/consola)

## 🆚 对比原生 console

| 特性         | console.log   | log (consola) |
| ------------ | ------------- | ------------- |
| 彩色输出     | ❌ 白色       | ✅ 多种颜色   |
| 日志级别     | ⚠️ 需手动区分 | ✅ 内置多级别 |
| 标签分类     | ❌ 不支持     | ✅ withTag()  |
| 时间戳       | ❌ 需手动添加 | ✅ 自动添加   |
| 生产环境控制 | ❌ 需手动处理 | ✅ 自动控制   |
| emoji 支持   | ⚠️ 需手动添加 | ✅ 方便添加   |

## 💡 提示

1. **替换原有 console**：逐步将项目中的 `console.log` 替换为 `log.info`，`console.error` 替换为 `log.error`
2. **开发工具查看**：在微信开发者工具的 Console 面板可以看到彩色日志
3. **真机调试**：配合 vConsole 使用效果更佳
4. **性能影响**：生产环境会自动过滤低级别日志，不影响性能
